<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TESTE PHASER</title>
    <script src="./lib/phaser-3.55.2.js"></script>
    <style>
      body {
        background-color: black;
        color: white;
      }
    </style>
  </head>
  <body>
    <p id="loading" style="display: none">
      Please wait, loading Phaser build ...
    </p>

    <div id="phaser-example"></div>

    <script id="examplesrc" type="text/javascript">
      class Example extends Phaser.Scene {
        constructor() {
          super();
        }

        preload() {
          this.load.image(
            "tiles",
            "./assets/tilemaps/tiles/drawtiles-spaced.png"
          );
          //this.load.image("car", "./assets/sprites/car90.png");
          this.load.image("car", "./assets/sprites/corona.ico");
          this.load.tilemapCSV("map", "./assets/tilemaps/csv/grid.csv");
        }

        create() {
          var map = this.make.tilemap({
            key: "map",
            tileWidth: 32,
            tileHeight: 32,
          });
          var tileset = map.addTilesetImage("tiles", null, 32, 32, 1, 2);
          var layer = map.createLayer(0, tileset, 0, 0);

          var player = this.add.image(32 + 16, 32 + 16, "car");

          this.input.keyboard.on("keydown", function (event) {
            console.log("keydown-arguments:", arguments);
            console.log("keydown-event:", event);

            switch (event.key) {
              case "ArrowLeft":
              case "a":
                var tile = layer.getTileAtWorldXY(
                  player.x - 32,
                  player.y,
                  true
                );
                if (tile.index === 2) {
                  //  Blocked, we can't move
                } else {
                  player.x -= 32;
                  //player.angle = 180;
                }
                break;

              case "ArrowRight":
              case "d":
                var tile = layer.getTileAtWorldXY(
                  player.x + 32,
                  player.y,
                  true
                );

                if (tile.index === 2) {
                  //  Blocked, we can't move
                } else {
                  player.x += 32;
                  //player.angle = 0;
                }
                break;

              case "ArrowDown":
              case "s":
                var tile = layer.getTileAtWorldXY(
                  player.x,
                  player.y + 32,
                  true
                );

                if (tile.index === 2) {
                  //  Blocked, we can't move
                } else {
                  player.y += 32;
                  //player.angle = 90;
                }
                break;
              case "ArrowUp":
              case "w":
                var tile = layer.getTileAtWorldXY(
                  player.x,
                  player.y - 32,
                  true
                );

                if (tile.index === 2) {
                  //  Blocked, we can't move
                } else {
                  player.y -= 32;
                  //player.angle = -90;
                }
                break;
            }
          });

         
        }

        update() {
          //console.log("update")
        }
      }

      const config = {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        parent: "phaser-example",
        pixelArt: true,
        backgroundColor: "#1a1a2d",
        scene: [Example],
      };

      const game = new Phaser.Game(config);
    </script>
  </body>
</html>
